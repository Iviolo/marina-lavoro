<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Gestione Lavoro, Guardia, Recupero, Straordinario e Forfettario - Marina Militare</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto&family=Roboto+Slab&display=swap');
  body {
    font-family: 'Roboto', sans-serif;
    background-color: #e9f0f8;
    color: #003366;
    margin: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  header {
    width: 90%;
    max-width: 900px;
    text-align: center;
    margin-bottom: 20px;
    position: relative;
    padding: 60px 20px 40px;
    color: white;
    font-weight: 700;
    font-size: 2.6em;
    background-color: #002D62;
    border-radius: 12px;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    overflow: hidden;
    font-family: 'Roboto Slab', serif;
  }
  header::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 300px;
    height: 300px;
    background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/5/5e/MarinaMilitare_Emblem.svg/512px-MarinaMilitare_Emblem.svg.png') no-repeat center center;
    background-size: contain;
    opacity: 0.1;
    transform: translate(-50%, -50%);
    filter: drop-shadow(0 0 10px rgba(0,0,0,0.3));
    pointer-events: none;
    z-index: 0;
  }
  header > * {
    position: relative;
    z-index: 1;
  }

  main {
    width: 90%;
    max-width: 900px;
    background: white;
    padding: 25px 25px 30px;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.15);
  }
  #meseAnno {
    font-size: 1.8em;
    font-weight: 700;
    margin-bottom: 25px;
    text-align: center;
  }
  #oreResidueContainer {
    margin-bottom: 20px;
    font-weight: 700;
    font-size: 1.1em;
    display: flex;
    align-items: center;
  }
  #oreResidueInput {
    margin-left: 10px;
    width: 90px;
    padding: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-weight: 600;
  }
  label { margin-right: 10px; font-weight: 600; }
  input[type="date"], input[type="number"], select {
    padding: 7px 10px;
    margin-right: 15px;
    border-radius: 5px;
    border: 1px solid #bbb;
    font-size: 1em;
    outline: none;
    width: auto;
  }
  button {
    padding: 9px 20px;
    background-color: #00539C;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 700;
    font-size: 1em;
  }
  button:hover { background-color: #003D66; }
  h3 {
    margin-top: 30px;
    color: #003366;
    font-weight: 700;
    letter-spacing: 0.05em;
  }
  table {
    border-collapse: collapse;
    margin-top: 12px;
    width: 100%;
    background: white;
    font-size: 0.95em;
    box-shadow: 0 2px 5px rgb(0 0 0 / 0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 12px 10px;
    text-align: center;
  }
  th {
    background-color: #00539C;
    color: white;
    font-weight: 700;
  }
  #totali {
    margin-top: 18px;
    font-weight: 700;
    font-size: 1.2em;
    color: #003366;
    text-align: center;
  }
  #calendario {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 10px;
    margin-top: 35px;
  }
  .giorno {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    min-height: 95px;
    position: relative;
    cursor: default;
    background: #f8fbfd;
    user-select: none;
  }
  .giorno.inactive {
    background-color: #eee;
    color: #aaa;
  }
  .numeroGiorno {
    font-weight: 700;
    font-size: 1.15em;
    margin-bottom: 8px;
  }
  .pallino {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    display: inline-block;
    margin: 3px 4px 3px 0;
  }
  .lavoro { background-color: #8B4513; }       /* Marrone */
  .guardia { background-color: #B22222; }      /* Rosso */
  .recupero { background-color: #228B22; }     /* Verde */
  .straordinario { background-color: #1E90FF; }/* Blu */
  .gf { background-color: #FFA500; }           /* Arancione */
</style>
</head>
<body>

<header>
  Gestione Lavoro, Guardia, Recupero, Straordinario e Forfettario - Marina Militare
</header>

<main>

  <div id="meseAnno"></div>

  <div id="oreResidueContainer">
    <label for="oreResidueInput">Ore residue guardia iniziali:</label>
    <input type="number" id="oreResidueInput" min="0" step="0.5" value="0" />
    <button onclick="aggiornaOreResidue()">Aggiorna</button>
  </div>

  <label for="dataInput">Seleziona </label>
  <input type="date" id="dataInput" min="2025-01-01" max="2025-12-31" />

  <label for="tipoSelect">Tipo attività:</label>
  <select id="tipoSelect">
    <option value="lavoro">Lavoro</option>
    <option value="guardia">Guardia</option>
    <option value="recupero">Recupero Psicofisico</option>
    <option value="straordinario">Straordinario</option>
  </select>

  <div id="inputStraordinarioContainer" style="display:none; margin-top:10px;">
    <label for="oreStraordInput">Ore straordinario:</label>
    <input type="number" id="oreStraordInput" min="0" step="0.5" value="0" />
  </div>

  <button onclick="aggiungiGiorno()">Aggiungi</button>

  <h3>Giornate Registrate</h3>
  <table id="tabellaGiornate">
    <thead>
      <tr>
        <th>Data</th>
        <th>Tipo</th>
        <th>Ore Recupero</th>
        <th>GF</th>
        <th>Forfettario (&euro;)</th>
        <th>Ore Straordinario</th>
        <th>Elimina</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <p id="totali">
    Ore Recupero totali: 0 | Giorni GF: 0 | Forfettario totale: 0&nbsp;&euro; | Ore Straordinario: 0
  </p>

  <div id="calendario"></div>
</main>

<script>
const meseNomi = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio',
  'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];

let dati = [];
let dataCorrente = new Date();
let oreResidueGuardia = 0;

// Mostra/nasconde input ore straordinario in base a tipo attività
document.getElementById('tipoSelect').addEventListener('change', () => {
  const val = document.getElementById('tipoSelect').value;
  document.getElementById('inputStraordinarioContainer').style.display = val === 'straordinario' ? 'block' : 'none';
});

// Aggiorna ore residue impostate dall’utente
function aggiornaOreResidue() {
  let oreVal = parseFloat(document.getElementById('oreResidueInput').value);
  if (isNaN(oreVal) || oreVal < 0) {
    alert('Inserisci un numero valido per le ore residue!');
    return;
  }
  oreResidueGuardia = oreVal;
  salvaDati();
  aggiornaTabella();
}

// Mostra mese e anno in alto
function mostraMeseAnno() {
  const mese = meseNomi[dataCorrente.getMonth()];
  const anno = dataCorrente.getFullYear();
  document.getElementById('meseAnno').textContent = `${mese} ${anno}`;
}

// Calcola parametri per guardia
function calcolaGuardia(dataString) {
  const [anno, mese, giorno] = dataString.split('-');
  const d = new Date(anno, parseInt(mese) - 1, giorno);
  const giornoSettimana = d.getDay();
  let oreRecupero = 0;
  let gf = 0;
  let forfettario = 0;
  if (giornoSettimana >= 1 && giornoSettimana <= 4) {
    oreRecupero = 8; forfettario = 30;
  } else if (giornoSettimana === 5) {
    oreRecupero = 12; forfettario = 30;
  } else if (giornoSettimana === 0 || giornoSettimana === 6) {
    oreRecupero = 8; gf = 1; forfettario = 90;
  }
  return { oreRecupero, gf, forfettario };
}

function aggiungiGiorno() {
  const dataInput = document.getElementById('dataInput').value;
  const tipoSelect = document.getElementById('tipoSelect').value;
  const oreStraordInput = parseFloat(document.getElementById('oreStraordInput').value) || 0;

  if (!dataInput) {
    alert('Seleziona una data!');
    return;
  }

  if (tipoSelect === 'straordinario' && oreStraordInput <= 0) {
    alert('Inserisci ore straordinario maggiori di zero!');
    return;
  }

  let entry = { dataInput, tipo: tipoSelect, oreRecupero: 0, gf: 0, forfettario: 0, oreStraordinario: 0};

  if (tipoSelect === "guardia") {
    const params = calcolaGuardia(dataInput);
    entry.oreRecupero = params.oreRecupero;
    entry.gf = params.gf;
    entry.forfettario = params.forfettario;
  } else if (tipoSelect === "straordinario") {
    entry.oreStraordinario = oreStraordInput;
  }

  if (dati.some(g => g.data === entry.data && g.tipo === entry.tipo)) {
    if (tipoSelect === "straordinario") {
      const idx = dati.findIndex(g => g.data === entry.data && g.tipo === entry.tipo);
      dati[idx].oreStraordinario += entry.oreStraordinario;
      salvaDati();
      aggiornaTabella();
      creaCalendario();
      resetForm();
      return;
    } else {
      alert('Giornata già registrata per questa data e tipo.');
      return;
    }
  }

  dati.push(entry);
  salvaDati();
  aggiornaTabella();
  creaCalendario();
  resetForm();
}

function eliminaGiorno(idx) {
  dati.splice(idx, 1);
  salvaDati();
  aggiornaTabella();
  creaCalendario();
}

function aggiornaTabella() {
  const tbody = document.querySelector('#tabellaGiornate tbody');
  tbody.innerHTML = '';

  let totOreRecupero = 0, totGF = 0, totForfettario = 0, totOreStraordinario = 0;
  dati.forEach((g, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${g.data}</td>
      <td>${g.tipo}</td>
      <td>${g.oreRecupero}</td>
      <td>${g.gf}</td>
      <td>${g.forfettario}</td>
      <td>${g.oreStraordinario || 0}</td>
      <td><button onclick="eliminaGiorno(${idx})">Elimina</button></td>
    `;
    tbody.appendChild(tr);

    totOreRecupero += g.oreRecupero;
    totGF += g.gf;
    totForfettario += g.forfettario;
    totOreStraordinario += g.oreStraordinario || 0;
  });

  const oreFinaliGuardia = oreResidueGuardia + totOreRecupero;

  document.getElementById('totali').textContent =
    `Ore Recupero totali: ${oreFinaliGuardia} (incluse residue: ${oreResidueGuardia}) | Giorni GF: ${totGF} | Forfettario totale: ${totForfettario} € | Ore Straordinario: ${totOreStraordinario}`;
}

function creaCalendario() {
  const calendario = document.getElementById('calendario');
  calendario.innerHTML = '';
  const anno = dataCorrente.getFullYear();
  const mese = dataCorrente.getMonth();
  const primoGiorno = new Date(anno, mese, 1).getDay();
  const giorniMese = new Date(anno, mese + 1, 0).getDate();
  let offset = primoGiorno === 0 ? 6 : primoGiorno -1;

  for (let i=0; i<offset; i++) {
    const cellaVuota = document.createElement('div');
    cellaVuota.classList.add('giorno','inactive');
    calendario.appendChild(cellaVuota);
  }

  for (let giorno=1; giorno<=giorniMese; giorno++) {
    const divGiorno = document.createElement('div');
    divGiorno.classList.add('giorno');
    const dataString = `${anno}-${String(mese+1).padStart(2,'0')}-${String(giorno).padStart(2,'0')}`;
    const numeroGiorno = document.createElement('div');
    numeroGiorno.classList.add('numeroGiorno');
    numeroGiorno.textContent = giorno;
    divGiorno.appendChild(numeroGiorno);

    const attivitaGiorno = dati.filter(d => d.data === dataString);

    attivitaGiorno.forEach(a => {
      const pallino = document.createElement('span');
      pallino.classList.add('pallino');
      if (a.tipo === 'lavoro') pallino.classList.add('lavoro');
      else if (a.tipo === 'guardia') pallino.classList.add('guardia');
      else if (a.tipo === 'recupero') pallino.classList.add('recupero');
      else if (a.tipo === 'straordinario') pallino.classList.add('straordinario');
      if (a.gf) pallino.classList.add('gf');
      divGiorno.appendChild(pallino);
    });

    calendario.appendChild(divGiorno);
  }
}

function salvaDati() {
  localStorage.setItem('giornate2025', JSON.stringify(dati));
  localStorage.setItem('oreResidueGuardia', oreResidueGuardia);
}
function caricaDati() {
  dati = JSON.parse(localStorage.getItem('giornate2025')) || [];
  oreResidueGuardia = parseFloat(localStorage.getItem('oreResidueGuardia')) || 0;
  document.getElementById('oreResidueInput').value = oreResidueGuardia;
}

function resetForm() {
  document.getElementById('dataInput').value = '';
  document.getElementById('tipoSelect').value = 'lavoro';
  document.getElementById('oreStraordInput').value = 0;
}

window.onload = () => {
  caricaDati();
  mostraMeseAnno();
  aggiornaTabella();
  creaCalendario();
};
</script>
</body>
</html>
